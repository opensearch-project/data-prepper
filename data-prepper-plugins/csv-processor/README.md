# CSV Processor
This is a processor that takes in an Event and parses its CSV data into columns.
## Basic Usage
### User Specified Column Names
To get started, create the following `pipelines.yaml`.
```yaml
csv-pipeline:
  source:
    file:
      path: "/full/path/to/ingest.csv"
      record_type: "event"
  processor:
    - csv:
        column_names: ["col1", "col2"]
  sink:
    - stdout:
```
Create the following file `ingest.csv` and replace the `path` in the file source of your `pipeline.yaml` with the path of this file.
```
1,2,3
```

When run, the processor will parse the message. Notice that since there are only two column names specified in the config, the third column name is autogenerated.
```
{"message": "1,2,3", "col1": "1", "col2": "2", "column3": "3"}
```
### Auto Detect Column Names
The following configuration auto detects the header of a CSV file ingested through S3 Source. See the [S3 Source Documentation](https://github.com/opensearch-project/data-prepper/tree/main/data-prepper-plugins/s3-source) for more information.
```yaml
csv-s3-pipeline:
  source:
    s3:
      notification_type: "sqs"
      codec:
        newline:
          skip_lines: 1
          header_destination: "header"
      compression: none
      sqs:
        queue_url: "https://sqs.<region>.amazonaws.com/<account id>/<queue name>"
      aws:
        region: "<region>"
  processor:
    - csv:
        column_names_source_key: "header"
  sink:
    - stdout:
```
Upload the following file `ingest.csv` to the S3 bucket that your SQS queue is attached to:
```
Should,skip,this,line
a,b,c
1,2,3
```
When run, the processor will process the following event:
```json
{"header": "a,b,c", "message": "1,2,3"}
```
And will parse it into the following. (Note that since `delete_header` is `true`, the header is deleted):
```json
{"message": "1,2,3", "a": "1", "b": "2", "c": "3"}
```
## Configuration
* `source` — The field in the `Event` that will be parsed.
  * Default: `message`

* `quote_character` — The character used to escape quotes within a field.
  * Default: Double quote (`"`)

* `delimiter` — The character separating each column.
  * Default: `,`

* `delete_header` (Optional, boolean) — If specified, the header on the `Event` (`column_names_source_key`) will be deleted after the `Event` is parsed. If there’s no header on the `Event` then nothing will happen.
  * Default: `true`

* `column_names_source_key` — (Optional) The field in the Event that specifies the CSV column names, which will be autodetected. If there must be extra column names, they will be autogenerated according to their index.
  * There is no default.
  * Note: If column_names is also defined, the header in `column_names_source_key` will be used to generate the Event fields.
  * Note: If too few columns are specified in this field, the remaining column names will be autogenerated. If too many column names are specified in this field, then the extra column names will be omitted.

* `column_names` — (Optional) User-specified names for the CSV columns.
  * Default: `[column1, column2, ..., columnN]` if there are `N` columns of data in the CSV record and `column_names_source_key` is not defined.
  * Note: If `column_names_source_key` is defined, the header in `column_names_source_key` will be used to generate the Event fields.
  * Note: If too few columns are specified in this field, the remaining column names will be autogenerated. If too many column names are specified in this field, then the extra column names will be omitted.

## Developer Guide
This plugin is compatible with Java 8 and up. See
- [CONTRIBUTING](https://github.com/opensearch-project/data-prepper/blob/main/CONTRIBUTING.md)
- [monitoring](https://github.com/opensearch-project/data-prepper/blob/main/docs/monitoring.md)
